<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Registros de fundos • Atlas Energy</title>
  <link rel="stylesheet" href="movimentos.css" />
</head>
<body>
  <div class="dashboard">
    <header class="header">
      <a href="pessoal.html" class="back" aria-label="Voltar">←</a>
      <h1>Registros de fundos</h1>
      <span class="spacer" aria-hidden="true"></span>
    </header>

    <!-- Filtros -->
    <!-- <div class="filters" role="tablist" aria-label="Filtros de movimentos">
      <button class="filter-btn active" data-type="all"></button>
      <button class="filter-btn" data-type="deposit"></button>
      <button class="filter-btn" data-type="withdraw"></button>
      <button class="filter-btn" data-type="commission"></button>
      <button class="filter-btn" data-type="ref_bonus"></button>
    </div> -->

    <!-- Skeleton -->
    <div id="skeleton" class="skeleton" aria-hidden="false">
      <div class="skeleton-item"></div>
      <div class="skeleton-item"></div>
      <div class="skeleton-item"></div>
    </div>

    <!-- Lista (renderizada pelo movimentos.js) -->
    <div id="list" class="mov-list" role="list" aria-live="polite"></div>

    <!-- Rodapé "Não mais" (sempre visível abaixo da lista) -->
    <div class="list-end" aria-hidden="true"><span></span><strong>Não mais</strong><span></span></div>
  </div>

  <!-- Firebase + lógica (NÃO alterar este arquivo JS) -->
  <script type="module" src="./firebase-config.js"></script>
  <script type="module" src="./movimentos.js"></script>

  <!-- Pequeno script de UI: adiciona ícones e classes visuais aos cards (NÃO altera lógica) -->
  <script>
  (function(){
    const list = document.getElementById('list');

    // Adiciona ícone e classe visual a um card .mov-card
    function enhanceCard(card){
      if (!card || card._enhanced) return;
      const amountEl = card.querySelector('.mov-amount');
      const dir = (amountEl && amountEl.classList.contains('out')) ? 'out' : 'in';

      // cria ícone circular
      const icon = document.createElement('div');
      icon.className = 'mov-icon ' + dir;
      icon.setAttribute('aria-hidden', 'true');

      // seta SVG conforme direcção
      if (dir === 'out') {
        // arrow up (retirada in the image -> green negative)
        icon.innerHTML = `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v13"/><path d="M19 12l-7 7-7-7"/></svg>`;
      } else {
        // arrow down (rendimentos -> red positive)
        icon.innerHTML = `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V6"/><path d="M5 12l7-7 7 7"/></svg>`;
      }

      // insere no início do card
      card.insertBefore(icon, card.firstChild);

      // marca como melhorada para não repetir
      card._enhanced = true;
      // adiciona classe ao card para estilização global
      card.classList.add(dir);
    }

    // observa adições à lista
    const obs = new MutationObserver(muts => {
      muts.forEach(m => {
        m.addedNodes.forEach(node => {
          if (node.nodeType !== 1) return;
          if (node.classList && node.classList.contains('mov-card')) {
            enhanceCard(node);
          } else {
            // se adicionarem múltiplos (ex.: innerHTML com vários cards), varre filhos
            (node.querySelectorAll?.('.mov-card') || []).forEach(enhanceCard);
          }
        });
      });
    });

    obs.observe(list, { childList: true, subtree: false });

    // deixa um passinho inicial caso já existam cards (race conditions)
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.mov-card').forEach(enhanceCard);
      setTimeout(() => document.querySelectorAll('.mov-card').forEach(enhanceCard), 300);
    });
  })();
  </script>
</body>
</html>
