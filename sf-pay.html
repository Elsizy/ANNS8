<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SF-PAY • Escolher Banco</title>
  <style>
    /* ===== Cores idênticas ao visual do print ===== */
    :root{
      --brand: #39d2c7;          /* “TT PAY” turquesa — agora SF-PAY */
      --progress: #49b36a;       /* linha/círculos verdes do passo */
      --text: #0f172a;           /* cinza-azulado legível */
      --muted: #64748b;          /* descrição */
      --stroke: #e5e7eb;         /* borda caixas */
      --radius: 8px;             /* cantos retinhos como no print */
      --maxw: 420px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:#fff;
      color:var(--text);
      font:500 15px/1.45 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
      display:flex; align-items:center; justify-content:center;
    }

    .wrap{
      width:100%; max-width:var(--maxw);
      padding:18px 16px 22px;
      border:1px solid #efefef;       /* moldura leve como no print */
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,.04);
    }

    /* ===== Logo SF-PAY (posição/tamanho do print) ===== */
    .brand{
      display:flex; align-items:center; gap:10px;
      justify-content:center;
      margin-bottom:16px;
    }
    .brand-mark{
      width:40px; height:28px; border-radius:6px;
      background: linear-gradient(135deg, #6fe6dc, #2fc9be);
      position:relative; overflow:hidden;
    }
    .brand-mark::after{
      content:""; position:absolute; inset:0;
      background:
        linear-gradient( to bottom right, transparent 52%, rgba(255,255,255,.9) 53% 70%, transparent 71% );
      mix-blend-mode: screen; opacity:.85;
    }
    .brand-name{
      font-weight:800; font-size:26px; letter-spacing:.5px;
      color: var(--brand);
    }

    /* ===== Stepper (3 passos) — igual ao print ===== */
    .steps{
      display:grid; grid-template-columns: 1fr 1fr 1fr;
      align-items:center; gap:14px;
      position:relative; margin:8px 8px 18px;
    }
    .steps::before{
      content:""; position:absolute; top:18px; left:calc(16px + 22px); right:calc(16px + 22px);
      height:3px; background:var(--progress); /* linha verde */
    }
    .step{
      display:grid; justify-items:center; gap:6px;
    }
    .dot{
      width:36px; height:36px; border-radius:999px;
      display:grid; place-items:center;
      border:2px solid var(--progress);
      background:#fff; color:var(--progress); font-weight:800;
    }
    .step.active .dot{
      background:var(--progress); color:#fff; /* passo ativo cheio */
    }
    .step label{ font-size:14px; color:#3c82c9; font-weight:700 } /* legenda azul claro como no print */

    /* ===== Lista de bancos (botões grandes) ===== */
    .bank-list{ display:grid; gap:12px; margin:18px 0 }
    .bank{
      border:1px solid var(--stroke); border-radius: var(--radius);
      padding:12px 14px; text-align:center; cursor:pointer; user-select:none;
      transition: background .12s ease, border-color .12s ease, box-shadow .12s ease;
      background:#f8fbfd;
    }
    .bank:hover{ background:#eef6ff }
    .bank.active{
      border-color:#79c0ff;
      box-shadow: 0 0 0 2px rgba(123, 190, 255, .35) inset;
      background:#fff;
    }

    /* ===== Barra de ações em baixo (igual, 2 botões mesma linha) ===== */
    .actions{
      display:flex; gap:12px; justify-content:space-between; margin-top:10px;
    }
    .btn{
      flex:1; height:44px; border-radius: 999px; /* no print o botão é oval */
      display:inline-flex; align-items:center; justify-content:center;
      font-weight:700; letter-spacing:.2px; text-decoration:none; cursor:pointer;
      border:1px solid var(--brand); background:transparent; color:var(--brand);
      transition: filter .12s ease, transform .04s ease;
    }
    .btn:hover{ filter:brightness(1.05) }
    .btn:active{ transform: translateY(1px) }
    .btn.primary{ background: var(--brand); color:#fff }
    .btn.primary:disabled{ opacity:.4; pointer-events:none }

    /* “rodapé” descritivo leve */
    .hint{ margin-top:12px; text-align:center; color:var(--muted); font-size:12px }
  </style>
</head>
<body>
  <main class="wrap" role="main">
    <!-- Logo -->
    <div class="brand" aria-label="SF-PAY">
      <div class="brand-mark" aria-hidden="true"></div>
      <div class="brand-name">SF-PAY</div>
    </div>

    <!-- Stepper -->
    <div class="steps" aria-label="Passos do pagamento">
      <div class="step active">
        <div class="dot">1</div>
        <label>Escolher</label>
      </div>
      <div class="step">
        <div class="dot">2</div>
        <label>Pagar</label>
      </div>
      <div class="step">
        <div class="dot">3</div>
        <label>Comprovativo</label>
      </div>
    </div>

    <!-- Bancos -->
    <section aria-labelledby="t-banco">
      <h2 id="t-banco" style="margin:0 0 8px; font-size:16px; font-weight:700; text-align:left; color:#234;">
        Banco
      </h2>
      <div id="bank-list" class="bank-list" role="listbox" aria-label="Escolha o banco"></div>
    </section>

    <!-- Ações -->
    <div class="actions">
      <a class="btn" href="pessoal.html">Anterior</a>
      <button id="next" class="btn primary" disabled>Próxima etapa</button>
    </div>

    <p class="hint">Selecione um banco para continuar.</p>
  </main>

  <!-- Lógica (usa adminBanks; fallback estático) -->
  <script type="module">
    const DRAFT_KEY = "deposit_draft_v1";
    const bankListEl = document.getElementById("bank-list");
    const nextBtn    = document.getElementById("next");

    let draft = null;
    let selectedKey = null;
    let ADMIN_BANKS = {};

    // tenta carregar rascunho
    try{
      draft = JSON.parse(sessionStorage.getItem(DRAFT_KEY) || "{}");
    }catch{ draft = {}; }

    // tenta Firebase (se existir), senão usa fallback
    (async function loadBanks(){
      try{
        // importa só se existir o ficheiro de config
        const { auth, db } = await import("./firebase-config.js");
        const { onAuthStateChanged } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js");
        const { ref, get } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js");

        onAuthStateChanged(auth, async (user) => {
          if (!user) { location.href = "login.html"; return; }
          const snap = await get(ref(db, "adminBanks"));
          ADMIN_BANKS = snap.exists() ? snap.val() : {};
          render();
        });
      }catch(e){
        // fallback: estático no mesmo layout
        ADMIN_BANKS = {
          atl: { name:"ATL" },
          bfa: { name:"BFA" },
          bai: { name:"BAI" },
        };
        render();
      }
    })();

    function render(){
      bankListEl.innerHTML = "";
      const keys = Object.keys(ADMIN_BANKS);
      if (!keys.length){
        bankListEl.innerHTML = `<div class="bank" style="opacity:.6">Nenhum banco disponível</div>`;
        return;
      }

      keys.forEach((k) => {
        const b = ADMIN_BANKS[k];
        const li = document.createElement("button");
        li.type = "button";
        li.className = "bank";
        li.role = "option";
        li.textContent = (b?.name || "").toString().trim() || "—";
        li.addEventListener("click", () => {
          selectedKey = k;
          [...bankListEl.children].forEach(el => el.classList.remove("active"));
          li.classList.add("active");
          nextBtn.disabled = false;
        });
        bankListEl.appendChild(li);
      });

      nextBtn.addEventListener("click", () => {
        if (!selectedKey) return;
        const b = ADMIN_BANKS[selectedKey] || {};
        draft.bank = b.name || "";
        draft.bankData = {
          id: selectedKey,
          name: b.name || "",
          iban: b.iban || "",          // admin pode preencher no DB
          holder: b.holder || ""
        };
        sessionStorage.setItem(DRAFT_KEY, JSON.stringify(draft));
        location.href = "sf-pay-set.html";
      });
    }
  </script>
</body>
  </html>
